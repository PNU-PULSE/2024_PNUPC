# 한빛미디어

### 시간 제한: 1.5초, 메모리 제한: 512mb

![IMG_3622.png](image/IMG_3622.png)

한빛미디어(주)는 ‘책으로 여는 IT 세상’을 만들어 갑니다. IT 세상의 주역은 ‘우리’ 입니다. 한빛미디어(주)는 IT 세상의 주역들을 위한 프로그래밍, 컴퓨터공학, IT 에세이, Make, 리얼타임(전자책), OA, 그래픽, 나와 내 아이를 위한 실용 등 다양한 분야의 책으로 IT 세상을 만들어 가고 있습니다.

산지니는 2022년부터 부산대학교 프로그래밍 대회의 후원사를 맡아온 한빛미디어의 요청을 받아 한빛미디어가 출판한 책들의 데이터베이스를 이용한 웹사이트의 책 진열 프로그램 개발 요청을 받았다. 데이터베이스의 책들은 웹사이트의 페이지에 진열되며, 각각의 책은 가격 $S(10^3 \leq S \leq 10^9)$ 를 가진다. 서로 다른 책이 같은 가격을 가질 수 있으며, 질의에 들어오는 책들은 **모두 다른 책**이다. 책을 진열하기 위한 조건은 다음과 같다.

- 책은 한 페이지에 한 권 이상 진열할 수 있다.
- 같은 페이지에 진열된 어느 두 책의 쌍에 대해서 가격이 2배 이상 차이가 나면 안 된다. 예를 들어, 가격이 $3000$원인 책과 가격이 $5000$원인 책은 동시에 진열 가능하지만, $3000$원인 책과 $6000$원인 책은 동시에 진열될 수 없다.

산지니는 곰곰히 생각하다가 페이지가 많아지면 고객들이 책을 찾기 힘들 것이라고 생각하기 때문에, 페이지의 수를 최소화하기로 결심했다. 그런데, 자신이 정한 조건에 맞게 프로그램을 개발하겠다고 계획서를 한빛미디어에 제출했더니, 추가로 한빛미디어 측에 연락이 왔다.

- 신간이 추가될 수도 있고, 절판되서 더 이상 판매할 수 없을 수도 있기 때문에 책들이 저장된 데이터베이스에 들어오는 질의들을 고려해서 빠르게 진열 상태를 결정할 수 있는 프로그램을 만들어 주세요.

책들의 데이터베이스에 들어오는 질의는 다음과 같다.

1. INSERT $S$ : 책들의 데이터베이스에 가격이 $S(10^3 \leq S \leq 10^9)$인 책을 하나 추가한다. 
2. DELETE $S$ : 책들의 데이터베이스에 가격이 $S(10^3 \leq S \leq 10^9)$인 책을 하나 제거한다. 만약 가격이 $S$인 책이 두 개 이상이라면 데이터베이스에 가장 오래 전에 추가된 책을 제거한다. 단, 가격이 $S$인 책이 존재하지 않을 경우, 질의를 무시한다.
3. SHOW : 데이터베이스의 책들을 진열할 수 있는 최소의 페이지 수를 출력한다. 만약 데이터베이스에 책이 존재하지 않을 경우 $-1$을 출력한다.

산지니는 이걸 어떻게 해야할 지 고민하고 있다. 우리가 산지니를 위해 프로그램을 대신 짜주자.

### 입력

첫 번째 줄에 질의의 개수 $Q(2 ≤ Q ≤ 200,000)$ 가 주어진다.

두 번째 줄부터 $Q + 1$번째 줄까지 질의가 공백으로 구분지어 주어진다.

3번 질의는 최소 $1$번 들어온다. 1번 질의에 들어오는 책들은 서로 같은 가격인 경우도 **모두 다른 책이다.**

### 출력

3번 질의가 입력될 때마다, 조건에 부합하기 위해 필요한 최소 페이지의 수를 출력한다.

## 힌트

2024년 2월 22일 기준, 한빛미디어에서 판매하는 책 중 가장 가격이 높은 책은 73000원이다.

### 풀이

- Tree Set + Greedy
- 원소가 구간이 끊어진 첫 번째 원소의 2배 이상이 될 때마다 구간을 끊어주면 성립(구간을 끊는 첫 번째 원소들은 같은 페이지 내에 들어올 수 없으므로 하계가 보장, 두 배씩 끊은 구간이 존재하므로 상계가 보장됨 -> 증명) + 연속된 구간이 항상 답이 될 수 있음을 증명
- map을 사용해서 1번, 2번 쿼리를 $O(logQ)$에 처리, 3번 쿼리를 $O(logQ \times log(10^9/10^3 = 10^6))$ 에 처리 
